# warp10-udf-influxdb
This project correspond to a [Warp 10 UDF](http://www.warp10.io/reference/miscellaneous/UDF/#sidebar) to load GTS from Influx-DB databases.

## Usage
This function takes the following parameters as entry: an influxDB user, his password, the influxDB url, the database, a column map and an influx query.
The column map correspond to the column from the result table generated by the query. Timestamp and class field are mandatory. 
For each key, associate the position, or the column name in the InfluxDB table (Starting from 0). 
For the class and the labels keys, the value correspond to a map with the position or column name (in InfluxDB) as key, and the wanted name in Warp10 as value. Using NULL here as value, then the same name than the Influx one is kept.

For the timestamp key using NULL, will result in loading the column "time" of InfluxDB. 
Latitude and longitude must contains values of type Double. 
Elevation can be Long or Double but will be rounded to the nearest Long.

Here a small example is given.
```
'http://localhost:8086' // URL
'user'      // Influx user
'pwd'       // Password
'mydb'      // Database
            // A map
{
    'timestamp' 0
    'class' 
    {
        'idle' 'idle'
        4 'cpu'
    }
    'labels'
    {
        'host' 'server'
        1 'serie'
    }
    'elevation' 5
    'latitude'  'lat'
    'longitude' 'long'
}
            // A query
'SELECT *  FROM table'
'io.warp10.InfluxDB.LOADFROMINFLUX' UDF
```


## Set-up 
Build this project, and then add the generated jar in Warp 10 server.

### Build the Jar ###
Clone this repository then execute the following command to build a jar.
```
gradle pack
```

### Warp 10 conf
Open the Warp 10 conf file and you have to configure both following parameters to allow udf. Then copy the jar generated by gradle in warpscript.jars.directory.
```
warpscript.jars.directory = /some/dir/udf
warpscript.jars.refresh = 60000
```
